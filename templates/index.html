<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <link rel="stylesheet" type= "text/css" href= "{{ url_for('static',filename='style.css') }}">
    <title>Viewer</title>
  </head>
  <div id="div_wrapper" onclick="next_image()">
    <body>
      <!-- <p id="debug_display">{{ response['link'] }}</p> -->
      <img crossorigin="anonymous" id="main_img" src="{{ response['link'] }}"></img>
    </body>
  </div>
  <script>

    function switch_image(new_link){
      var img_target = document.getElementById("main_img");
//      if ( !img_target.includes("static")
      img_target.crossOrigin = "Anonymous";
      // img_target.src = new_link;
      if ( new_link.includes("static")) {
        img_target.src = new_link;
      } else {
        img_target.src = new_link+"?not-from-cache-please";
      }

//      var debug = document.getElementById("debug_display");
//      debug.innerHTML = new_link;
    }

    function next_image(){
//      $.ajaxSetup({
//            headers: { 'Access-Control-Allow-Origin': '*' }
//      });
      $.ajax({
        type: 'GET',
        url: "/viewer_api",
        data: {},
        dataType: "text",
        success: function(resp_data){
//          $.get(resp_data, function(data) {
//            console.log(data);
//            }).done(function() {
//              console.log("It looks like it went through");
//              // TO DO ON DONE
//            }).fail(function(data, textStatus, xhr) {
//              //This shows status code eg. 403
//              console.log("error", data.status);
//              //This shows status message eg. Forbidden
//              console.log("STATUS: "+xhr);
//            }).always(function() {
//              //TO-DO after fail/done request.
//              console.log("ended");
//            });
          switch_image(resp_data);
          console.log("Link Pulled:");
          console.log(resp_data);

        }
      });
    }

  </script>
</html>
